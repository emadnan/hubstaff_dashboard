"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[9585],{69585:function(t,e,n){n.r(e),n.d(e,{default:function(){return L}});var r=n(93433),c=n(29439),o=n(72791),a=n(68870),s=n(34663),i=n(20890),l=n(13400),d=n(36520),h=n(65560),u=n(79836),f=n(53382),j=n(53994),x=n(39281),m=n(56890),p=n(35855),S=n(35527),g=n(78983),Z=n(99954),O=n(81640),v=n(15696),T=n(86675),E=n(64802),y=n(3379),A=n.n(y),Y=n(72426),D=n.n(Y),R=n(97892),U=n.n(R),N=n(33156),H=n(47648),M=n.n(H),C=n(80184),I="http://10.3.3.80",b={width:"100%"},w={width:"100%",backgroundColor:"#FFFFFF "},_={backgroundColor:"white ",padding:"15px",fontFamily:"Arial",fontSize:14,textAlign:"center",alignSelf:"flex-end"},k={color:"white",backgroundColor:"#0070FF ",padding:"15px",fontFamily:"Arial",textAlign:"center",alignSelf:"flex-end"},F={color:"#9E9E9E"},P={color:"#28B463"},W={fontSize:"medium",fontWeight:"bold"};function L(){var t=(0,o.useRef)(null),e=(0,o.useState)(""),n=(0,c.Z)(e,2),y=n[0],Y=n[1],R=(0,o.useState)(),H=(0,c.Z)(R,2),L=H[0],V=H[1],J=(0,o.useState)([]),G=(0,c.Z)(J,2),z=G[0],B=G[1],q=(0,o.useState)([]),K=(0,c.Z)(q,2),Q=K[0],X=K[1],$=(0,o.useState)([]),tt=(0,c.Z)($,2),et=tt[0],nt=tt[1],rt=(0,o.useState)([]),ct=(0,c.Z)(rt,2),ot=ct[0],at=ct[1],st=(0,o.useState)(),it=(0,c.Z)(st,2),lt=it[0],dt=it[1],ht=(0,o.useState)(0),ut=(0,c.Z)(ht,2),ft=ut[0],jt=ut[1],xt=(0,o.useState)(),mt=(0,c.Z)(xt,2),pt=(mt[0],mt[1],(0,o.useState)([])),St=(0,c.Z)(pt,2),gt=St[0],Zt=St[1],Ot=(0,o.useState)([]),vt=(0,c.Z)(Ot,2),Tt=vt[0],Et=vt[1],yt=(0,o.useState)(!1),At=(0,c.Z)(yt,2),Yt=At[0],Dt=At[1],Rt=(0,o.useState)(null),Ut=(0,c.Z)(Rt,2),Nt=Ut[0],Ht=Ut[1],Mt=JSON.parse(localStorage.getItem("user-info")),Ct=function(t){return["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][t]},It=function(t){Mt?fetch("".concat(I,"/api/calculateMonthlyActivity/").concat(t)).then((function(t){return t.json()})).then((function(t){var e=t.project.reduce((function(t,e){return t+3600*e.hours+60*e.minutes+e.seconds}),0)/t.project.length,n=0,c=0;e>0&&(n=Math.floor(e/3600),c=Math.floor(e%3600/60)),jt("".concat(n.toString().padStart(2,"0"),": ").concat(c.toString().padStart(2,"0"))),Y("".concat(t.hours.toString().padStart(2,"0"),":").concat(t.minutes.toString().padStart(2,"0"),":").concat(t.seconds.toString().padStart(2,"0")));var o=t.project.map((function(t){return new Date(t.date)})),a=new Date(Math.min.apply(Math,(0,r.Z)(o))),s=new Date(Math.max.apply(Math,(0,r.Z)(o))),i="".concat(Ct(a.getMonth())," ").concat(a.getDate().toString().padStart(2,"0"),", ").concat(a.getFullYear()),l="".concat(Ct(s.getMonth())," ").concat(s.getDate().toString().padStart(2,"0"),", ").concat(s.getFullYear()),d="".concat(i," - ").concat(l);B(d),Ft(t)})).catch((function(t){return console.log(t)})):console.log("Local variable is not available")},bt=function(t,e,n){fetch("".concat(I,"/api/getSumByDateWithUserId/").concat(t,"/").concat(e,"/").concat(n)).then((function(t){return t.json()})).then((function(t){var e=t.projects.reduce((function(t,e){return t+3600*e.hours+60*e.minutes+e.seconds}),0)/t.projects.length,n=0,r=0;e>0&&(n=Math.floor(e/3600),r=Math.floor(e%3600/60)),jt("".concat(n.toString().padStart(2,"0"),": ").concat(r.toString().padStart(2,"0"))),Y("\n           ".concat(t.hours.toString().padStart(2,"0"),": ").concat(t.minutes.toString().padStart(2,"0"),": ").concat(t.seconds.toString().padStart(2,"0"),"\n        ")),Pt(t)})).catch((function(t){return console.log(t)}))},wt=function(t){return new Date(t).toLocaleDateString("en-US",{weekday:"short",day:"2-digit",month:"short",year:"numeric"}).toUpperCase()},_t=function(t){var e=Math.floor(t/3600),n=Math.floor(t%3600/60);return"".concat(e.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))},kt=function(t){var e=t.split(":"),n=(0,c.Z)(e,2),r=n[0],o=n[1];return 3600*parseInt(r)+60*parseInt(o)},Ft=function(t){var e={};t.project.forEach((function(t){var n=t.date,r=t.hours,c=t.minutes,o=t.seconds,a=t.project_name,s=3600*r+60*c+o,i=wt(n);e[i]||(e[i]={date:i,totalWorkingHourOfDay:_t(0),projects:[]}),e[i].totalWorkingHourOfDay=_t(kt(e[i].totalWorkingHourOfDay)+s);var l=e[i].projects.find((function(t){return t.project===a}));l?l.HOURS=_t(kt(l.HOURS)+s):(l={project:a,HOURS:_t(s),ACTIVITY:"-"},e[i].projects.push(l))})),Object.values(e).forEach((function(t){var e=kt(t.totalWorkingHourOfDay);0!==e?t.projects.forEach((function(t){var e=kt(t.HOURS);t.ACTIVITY="".concat((e/25200*100).toFixed(0),"%")})):t.projects.forEach((function(t){t.ACTIVITY="0%"}))})),X(Object.values(e))},Pt=function(t){var e={};t.projects.forEach((function(t){var n=t.date,r=t.hours,c=t.minutes,o=t.seconds,a=t.project_name,s=3600*r+60*c+o,i=wt(n);e[i]||(e[i]={date:i,totalWorkingHourOfDay:_t(0),projects:[]}),e[i].totalWorkingHourOfDay=_t(kt(e[i].totalWorkingHourOfDay)+s);var l=e[i].projects.find((function(t){return t.project===a}));l?l.HOURS=_t(kt(l.HOURS)+s):(l={project:a,HOURS:_t(s),ACTIVITY:"-"},e[i].projects.push(l))})),Object.values(e).forEach((function(t){kt(t.totalWorkingHourOfDay);t.projects.forEach((function(t){var e=kt(t.HOURS);t.ACTIVITY="".concat((e/25200*100).toFixed(0),"%")}))})),X(Object.values(e))};(0,o.useEffect)((function(){!function(){if(Mt){var t=[];fetch("".concat(I,"/api/get_users")).then((function(t){return t.json()})).then((function(e){1===Mt.Users.role?t=e.Users:3===Mt.Users.role?(t=e.Users.filter((function(t){return t.company_id===Mt.Users.company_id&&3!==t.role&&1!==t.role})),console.log("filteredUsers in getUsers: ",t)):5!==Mt.Users.role&&6!==Mt.Users.role&&7!==Mt.Users.role||(t=e.Users.filter((function(t){return t.id===Mt.Users.id}))),Zt(t)})).catch((function(t){return console.log(t)}))}else console.log("Local variable is not available")}()}),[L]);return(0,C.jsxs)(a.Z,{children:[(0,C.jsx)(a.Z,{className:"row",children:(0,C.jsx)(a.Z,{className:"col-md 6",children:(0,C.jsx)(i.Z,{variant:"h4",children:"Monthly Reports"})})}),(0,C.jsxs)(a.Z,{className:"row justify-content-between",sx:{mt:1},children:[(0,C.jsx)(a.Z,{className:"col-md-3",children:(0,C.jsx)(Z.Z,{placeholder:"SELECT MONTH",onChange:function(t,e){Ht(e);var n=D()(e,"YYYY-MM"),r=n.clone().startOf("month").format("YYYY-MM-DD"),c=n.clone().endOf("month").format("YYYY-MM-DD");"Invalid date"!==r&&"Invalid date"!==c?bt(r,c,L):It(L);var o=Ct(n.month()),a=Ct(n.clone().endOf("month").month()),s="".concat(o," ").concat(D()(r).format("DD, YYYY")," - ").concat(a," ").concat(D()(c).format("DD, YYYY"));B(s)},value:Nt?U()(Nt,"YYYY-MM"):null,picker:"month",disabled:!Yt,style:{width:"100%"}})}),(0,C.jsx)(a.Z,{className:"col-md-7",sx:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:(0,C.jsx)(a.Z,{className:"col-md-5",children:(0,C.jsx)(O.Z.Item,{name:"select",hasFeedback:!0,children:(0,C.jsx)(v.Z,{placeholder:"SELECT EMPLOYEE",onChange:function(t){var e=gt.filter((function(e){return e.id===t}));Et(e),V(t),It(t),function(t){if(!Mt)return void console.log("Local variable is not available");var e=[];fetch("".concat(I,"/api/get_assign_projects")).then((function(t){return t.json()})).then((function(n){e=n.Project_Assigns.filter((function(e){return e.assign_projects_user_id===t})),console.log("filteredAssignedProjects: ",e),at(e),dt(e.length)})).catch((function(t){return console.log(t)}))}(t),function(t){var e=t[0].company_id,n=[];fetch("".concat(I,"/api/getcompany")).then((function(t){return t.json()})).then((function(t){n=t.companies.filter((function(t){return t.id===e})),nt(n)})).catch((function(t){return console.log(t)}))}(e),Dt(!0),Ht(null)},children:gt.map((function(t){return(0,C.jsx)(v.Z.Option,{value:t.id,children:t.name},t.id)}))})})})})]}),Yt&&!0===Yt?(0,C.jsxs)("div",{ref:t,children:[(0,C.jsx)(a.Z,{mt:2,children:(0,C.jsx)(T.Z,{style:b,children:(0,C.jsxs)(a.Z,{className:"row",children:[(0,C.jsxs)(a.Z,{className:"col-md-3",children:[(0,C.jsx)(i.Z,{variant:"h6",sx:F,children:"NO. OF ASSIGNED PROJECTS"}),(0,C.jsx)(i.Z,{variant:"h4",sx:P,children:lt})]}),(0,C.jsxs)(a.Z,{className:"col-md-3",children:[(0,C.jsx)(i.Z,{variant:"h6",sx:F,children:"TOTAL HOURS OF MONTH"}),(0,C.jsx)(i.Z,{variant:"h4",sx:P,children:y})]}),(0,C.jsxs)(a.Z,{className:"col-md-3",children:[(0,C.jsx)(i.Z,{variant:"h6",sx:F,children:"AVG. WORKING HOURS OF DAY"}),(0,C.jsx)(i.Z,{variant:"h4",sx:P,children:ft})]})]})})}),(0,C.jsx)(a.Z,{sx:{width:"100%",mt:2},children:(0,C.jsxs)(T.Z,{style:w,children:[(0,C.jsx)("h5",{style:F,children:"ASSIGNED PROJECTS"}),(0,C.jsxs)(g.Sx,{align:"middle",className:"mb-0 border",hover:!0,responsive:!0,style:{marginTop:"20px"},children:[(0,C.jsxs)(g.V,{color:"light",children:[(0,C.jsxs)(g.T6,{children:[(0,C.jsx)(g.is,{className:"text-center",style:k,children:"Project Name"}),(0,C.jsx)(g.is,{className:"text-center",style:k,children:"Stream Name"})]}),ot.map((function(t,e){return(0,C.jsxs)(g.T6,{children:[(0,C.jsx)(g.is,{className:"text-center",style:_,children:t.project_name}),(0,C.jsx)(g.is,{className:"text-center",style:_,children:t.stream_name})]},e)}))]}),(0,C.jsx)(g.NR,{})]})]})}),(0,C.jsx)(a.Z,{sx:{width:"100%",mt:2},children:(0,C.jsxs)(S.Z,{sx:{width:"100%",mb:2},children:[(0,C.jsxs)(s.Z,{sx:{pl:{sm:4},pr:{xs:2,sm:2},pt:2,mb:2},children:[et.map((function(t){return(0,C.jsxs)(i.Z,{sx:{flex:"1 1 100%",color:"blue"},variant:"h4",id:"tableTitle",component:"div",children:[t.company_name,(0,C.jsx)("span",{style:{fontSize:"medium",color:"gray",ml:4},children:t.city})]},t.id)}))," ",(0,C.jsx)(d.Z,{title:"Generate CSV Report",children:(0,C.jsx)(l.Z,{children:(0,C.jsx)(h.Z,{onClick:function(){var t=Tt[0].name,e=new Date(z.split(" - ")[0]),n=e.toLocaleString("en-US",{month:"long"}),r=e.getFullYear(),c=Q.map((function(t){return t.projects.map((function(e){return{DATE:t.date,"TOTAL DAY HOURS":t.totalWorkingHourOfDay,PROJECT:e.project,HOURS:e.HOURS,ACTIVITY:e.ACTIVITY}}))})).flat(),o=A().parse(c,{fields:["DATE","TOTAL DAY HOURS","PROJECT","HOURS","ACTIVITY"],header:!1}),a="Monthly Report\nEmployee: ".concat(t,"\nMonth: ").concat(n,"-").concat(r,"\nTotal Hours of ").concat(n,"-").concat(r,": ").concat(y,"\nAVG. Working Hours of Day in ").concat(n,"-").concat(r,": ").concat(ft,"\n"),s="".concat(a,"\n").concat("DATE,TOTAL DAY HOURS,PROJECT,HOURS,ACTIVITY","\n").concat(o),i=new Blob([s],{type:"text/csv;charset=utf-8"});(0,E.saveAs)(i,"".concat(Tt[0].name," Monthly-Report.csv"))}})})}),(0,C.jsx)(d.Z,{title:"Generate PDF Report",children:(0,C.jsx)(l.Z,{children:(0,C.jsx)(N.Z,{onClick:function(){var e=t.current;M()().set({margin:.5,filename:"".concat(Tt[0].name," Monthly-Report.pdf"),image:{type:"jpeg",quality:.98},html2canvas:{scale:2,logging:!0},jsPDF:{unit:"mm",format:"a3"}}).from(e).save()}})})})]}),(0,C.jsxs)(a.Z,{className:"row",style:{width:"90%",margin:"auto"},children:[(0,C.jsxs)(a.Z,{className:"col-md-6",children:[(0,C.jsx)(i.Z,{variant:"h5",sx:F,children:"EMPLOYEE NAME"}),(0,C.jsx)(i.Z,{variant:"h6",sx:{fontWeight:"bold"},children:Tt[0].name})]}),(0,C.jsxs)(a.Z,{className:"col-md-6",children:[(0,C.jsx)(i.Z,{variant:"h5",sx:F,children:"MONTH DATE RANGE"}),(0,C.jsx)(i.Z,{variant:"h6",sx:{fontWeight:"bold"},children:z})]})]}),(0,C.jsx)("div",{style:{width:"90%",margin:"auto",justifyItems:"center"},children:(0,C.jsx)(x.Z,{children:(0,C.jsxs)(u.Z,{sx:{minWidth:650,mb:4},children:[(0,C.jsx)(m.Z,{children:(0,C.jsxs)(p.Z,{children:[(0,C.jsx)(j.Z,{sx:W,children:"DATE"}),(0,C.jsx)(j.Z,{sx:W,children:"TOTAL DAY HOURS"}),(0,C.jsx)(j.Z,{sx:W,children:"PROJECTS"})]})}),(0,C.jsx)(f.Z,{children:Q.map((function(t){return(0,C.jsxs)(p.Z,{children:[(0,C.jsx)(j.Z,{style:{fontSize:"large"},children:t.date}),(0,C.jsx)(j.Z,{style:{fontSize:"large"},children:t.totalWorkingHourOfDay}),(0,C.jsx)(j.Z,{children:(0,C.jsxs)(u.Z,{children:[(0,C.jsx)(m.Z,{children:(0,C.jsxs)(p.Z,{children:[(0,C.jsx)(j.Z,{sx:W,children:"PROJECT"}),(0,C.jsx)(j.Z,{sx:W,children:"HOURS"}),(0,C.jsx)(j.Z,{sx:W,children:"ACTIVITY"})]})}),(0,C.jsx)(f.Z,{children:t.projects.map((function(t,e){return(0,C.jsxs)(p.Z,{children:[(0,C.jsx)(j.Z,{children:t.project}),(0,C.jsx)(j.Z,{children:t.HOURS}),(0,C.jsx)(j.Z,{children:t.ACTIVITY})]},e)}))})]})})]},t.date)}))})]})})})]})})]}):(0,C.jsx)(a.Z,{mt:2,children:(0,C.jsx)(T.Z,{style:b,children:(0,C.jsx)(a.Z,{className:"row",children:(0,C.jsx)(i.Z,{variant:"h6",sx:{color:"#9E9E9E",textAlign:"center"},children:"PLEASE SELECT THE EMPLOYEE, WHOM YOU WANNA GENERATE REPORT"})})})})]})}}}]);
//# sourceMappingURL=9585.6b1e9075.chunk.js.map